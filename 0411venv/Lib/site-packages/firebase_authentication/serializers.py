from django.utils.translation import gettext_lazy as _

from rest_framework import serializers
from phonenumber_field.serializerfields import PhoneNumberField

from .models import User

__all__ = "UserSerializer",


class UserSerializer(serializers.ModelSerializer):
    # new_password = serializers.CharField(write_only=True) # 일단 사용X.
    # confirm_new_password = serializers.CharField(write_only=True) # 일단 사용X.

    class Meta:
        model = User
        fields = (
            'id',
            'emailId',
            'password', # 추가
            'is_active',
            'is_staff',
            'is_superuser',
            # 'new_password',
            # 'confirm_new_password',
        )

    def validate(self, attrs):
        if self.context['request'].method == "POST":
            # if attrs.get('new_password') != attrs.get('confirm_new_password'):
            #     raise serializers.ValidationError({
            #         "new_password": _("Passwords are not equal."),
            #         "confirm_new_password": _("Passwords are not equal."),
            #     })
            # attrs.pop('confirm_new_password')
            attrs['password'] = attrs.pop('password') # 수정
        return attrs

    def create(self, validated_data):
        # return User.objects.create_user(**validated_data)
        return User.objects.create_user(
            # uid 따로 지정하지 않으면 default로 자동 생성하여 저장함.
            emailId = validated_data['emailId'],
            password = validated_data['password']
        )
